<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GLP-1 Research Title Generator</title>
    
    <!-- === Sharing Preview Metadata Fix === -->
    <!-- This helps control the title when the link is shared/copied -->
    <meta name="description" content="Generate highly original research titles on GLP-1 Agonists and Obstetrics/Gynaecology topics.">
    <meta property="og:title" content="GLP-1 Research Title Generator">
    <!-- =================================== -->

    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Setting the default font and ensuring smooth transitions */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb;
        }
        .container {
            max-width: 900px;
        }
        .btn-primary {
            transition: all 0.2s ease-in-out;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }
        .btn-primary:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 10px 15px -3px rgba(37, 99, 235, 0.2), 0 4px 6px -4px rgba(37, 99, 235, 0.1);
        }
        .btn-secondary {
            transition: all 0.2s ease-in-out;
        }
    </style>
    <!-- Preload Inter font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>

<div class="container mx-auto p-4 md:p-8">
    <header class="text-center mb-8">
        <h1 class="text-3xl md:text-4xl font-extrabold text-blue-800 mb-2">
            GLP-1 Research Title Generator
        </h1>
        <p class="text-lg text-gray-600">
            Generate your next blockbuster paper title on GLP-1 Agonists and Ob/Gyn.
        </p>
    </header>

    <main class="bg-white p-6 md:p-10 rounded-xl shadow-2xl border border-gray-100">

        <!-- Title Display -->
        <div class="mb-8">
            <h2 class="text-xl font-semibold text-gray-700 mb-3">Your Research Title:</h2>
            <div id="titleDisplay" class="min-h-[6rem] p-4 bg-gray-50 border-l-4 border-blue-500 rounded-lg text-2xl font-bold text-gray-800 flex items-center justify-center text-center">
                Press 'Generate New Title' to begin.
            </div>
        </div>
        
        <!-- Controls -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6 items-end">
            
            <div class="md:col-span-2">
                <label for="topicSelect" class="block text-sm font-medium text-gray-700 mb-2">Select a Topic (or choose 'Random'):</label>
                <select id="topicSelect" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 bg-white">
                    <option value="random">Random Topic</option>
                    <!-- Topics populated by JS -->
                </select>
            </div>

            <button onclick="generateTitle()" id="generateButton" class="w-full btn-primary bg-blue-600 text-white font-semibold py-3 rounded-xl hover:bg-blue-700">
                Generate New Title
            </button>
        </div>

        <!-- Search Button -->
        <button onclick="checkExistence()" id="checkButton" 
            class="w-full btn-secondary bg-gray-200 text-gray-700 font-medium py-3 rounded-xl hover:bg-gray-300 transition duration-150 mt-4 
            opacity-0 pointer-events-none disabled:opacity-50 disabled:cursor-not-allowed">
            Check Title Originality
        </button>

        <!-- Search Results -->
        <div id="resultsContainer" class="mt-8 pt-4 border-t border-gray-200 min-h-[4rem]">
            <!-- Results will appear here -->
        </div>

    </main>
</div>

<script type="module">
    // Define the list of Ob/Gyn topics
    const topics = [
        "Cervical ripening time during induction of labor",
        "Severity of morning sickness (Hyperemesis Gravidarum)",
        "Prevalence of Polycystic Ovary Syndrome (PCOS) symptoms",
        "Fetal growth trajectories in third trimester",
        "Risk of postpartum depression in first-time mothers",
        "Menopausal hot flash frequency and intensity",
        "Uterine fibroid growth rate",
        "Timing of spontaneous ovulation in irregular cycles",
        "Lactation suppression post-partum",
        "Endometrial thickness variability in post-menopausal women"
    ];

    // Define the structure of the paper titles
    const templates = [
        "The Paradoxical Effect of GLP-1 Agonist Initiation on {topic}: A Retrospective Cohort Study.",
        "Cessation of Semaglutide Therapy: Unmasking Latent Changes in {topic}.",
        "A Double-Blind, Placebo-Controlled Trial of Liraglutide on {topic} in Non-Diabetic Women.",
        "Examining the Causal Relationship between GLP-1 Receptor Activation and Alterations in {topic}.",
        "Impact of GLP-1 Mimetics on {topic} in Obese and Non-Obese Patients: A Pilot Study.",
        "Starting/Stopping Tirzepatide: The Unforeseen Impact on {topic} - A Meta-Analysis."
    ];

    let currentTitle = "";

    /**
     * Generates a research title based on a selected or random topic.
     */
    window.generateTitle = function() {
        const topicSelect = document.getElementById('topicSelect');
        let selectedTopic = topicSelect.value;
        
        // If 'random' is selected, pick a random topic
        if (selectedTopic === 'random') {
            selectedTopic = topics[Math.floor(Math.random() * topics.length)];
        }

        // Select random template
        const template = templates[Math.floor(Math.random() * templates.length)];

        // Construct title
        currentTitle = template.replace('{topic}', selectedTopic);

        // Update UI
        document.getElementById('titleDisplay').innerText = currentTitle;
        // Make the search button visible and clickable
        document.getElementById('checkButton').classList.remove('opacity-0', 'pointer-events-none');
        document.getElementById('resultsContainer').innerHTML = '';
        document.getElementById('checkButton').disabled = false;
        document.getElementById('checkButton').innerText = 'Check Title Originality';
    }

    /**
     * Checks if the generated title exists using the Google Search Grounding API.
     */
    window.checkExistence = async function() {
        if (!currentTitle) {
            document.getElementById('resultsContainer').innerHTML = `<p class="text-red-500">Please generate a title first.</p>`;
            return;
        }

        const checkButton = document.getElementById('checkButton');
        const resultsContainer = document.getElementById('resultsContainer');

        checkButton.disabled = true;
        checkButton.innerText = 'Searching Google...';
        
        // Show loading spinner
        resultsContainer.innerHTML = `
            <div class="flex items-center justify-center space-x-2 text-blue-600 p-4">
                <svg class="animate-spin h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <span>Analyzing originality...</span>
            </div>
        `;

        const userQuery = `Find academic papers, studies, or articles with the exact or very similar title: "${currentTitle}". Focus on finding published titles.`;
        const apiKey = ""; // API key will be provided by the Canvas environment
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

        const payload = {
            contents: [{ parts: [{ text: userQuery }] }],
            // Enable Google Search grounding
            tools: [{ "google_search": {} }],
            systemInstruction: {
                parts: [{ text: "You are a research originality validator. Use Google Search to find relevant academic papers or articles matching the user's title. If sources are found, summarize the findings briefly and list the sources. If no strong matches are found, state clearly that the title appears original for academic research." }]
            },
        };

        let resultHtml = '';
        let retries = 0;
        const maxRetries = 3;

        while (retries < maxRetries) {
            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (response.status === 429 && retries < maxRetries - 1) {
                    // Exponential backoff for rate limiting
                    const delay = Math.pow(2, retries) * 1000;
                    retries++;
                    await new Promise(resolve => setTimeout(resolve, delay));
                    continue; // Retry the loop
                }
                
                if (!response.ok) {
                    throw new Error(`API returned status ${response.status}`);
                }

                const result = await response.json();
                const candidate = result.candidates?.[0];

                if (candidate && candidate.content?.parts?.[0]?.text) {
                    const text = candidate.content.parts[0].text;
                    let sources = [];
                    const groundingMetadata = candidate.groundingMetadata;

                    if (groundingMetadata && groundingMetadata.groundingAttributions) {
                        sources = groundingMetadata.groundingAttributions
                            .map(attribution => ({
                                uri: attribution.web?.uri,
                                title: attribution.web?.title,
                            }))
                            .filter(source => source.uri && source.title);
                    }

                    if (sources.length > 0) {
                        const sourceList = sources.map(source => `
                            <li class="mb-1">
                                <a href="${source.uri}" target="_blank" class="text-blue-500 hover:text-blue-600 transition duration-150 font-medium">
                                    ${source.title}
                                </a>
                                <span class="text-sm text-gray-500 block truncate">${source.uri}</span>
                            </li>
                        `).join('');

                        resultHtml = `
                            <div class="p-4 bg-red-50 border-l-4 border-red-500 rounded-lg shadow-inner">
                                <p class="font-bold text-red-700 mb-2 flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" /></svg>Potential Match Found!</p>
                                <p class="text-red-800 mb-4">${text}</p>
                                <p class="font-semibold text-sm text-red-700">Sources suggesting similar research exists:</p>
                                <ul class="list-none pt-2">${sourceList}</ul>
                            </div>
                        `;
                    } else {
                        resultHtml = `
                            <div class="p-4 bg-green-50 border-l-4 border-green-500 rounded-lg shadow-inner">
                                <p class="font-bold text-green-700 mb-2 flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>Title Appears Original!</p>
                                <p class="text-green-800">${text}</p>
                                <p class="text-sm mt-2 text-green-600 font-medium">Congratulations! Your idea might be groundbreaking. Now, write the methods section!</p>
                            </div>
                        `;
                    }

                } else {
                    resultHtml = `
                        <div class="p-4 bg-yellow-50 border-l-4 border-yellow-500 rounded-lg shadow-inner">
                            <p class="font-bold text-yellow-700">No Definitive Answer</p>
                            <p class="text-yellow-800">The search was inconclusive. The title may be too complex or too vague. Try generating a new one.</p>
                        </div>
                    `;
                }
                break; // Break the retry loop on success
            } catch (error) {
                console.error("API Error (Attempt ${retries + 1}):", error);
                if (retries === maxRetries - 1) {
                    resultHtml = `
                        <div class="p-4 bg-yellow-50 border-l-4 border-yellow-500 rounded-lg shadow-inner">
                            <p class="font-bold text-yellow-700">Maximum Retries Exceeded</p>
                            <p class="text-yellow-800">Could not connect to the search service. Please check your network or try again in a moment.</p>
                        </div>
                    `;
                    break;
                }
                retries++;
            }
        }
        
        // Restore button state
        checkButton.disabled = false;
        checkButton.innerText = 'Check Title Originality';
        resultsContainer.innerHTML = resultHtml;
    }

    // Initialize the application
    document.addEventListener('DOMContentLoaded', () => {
        // Populate the topic select dropdown
        const topicSelect = document.getElementById('topicSelect');
        topics.forEach(topic => {
            const option = document.createElement('option');
            option.value = topic;
            option.textContent = topic;
            topicSelect.appendChild(option);
        });
        
        // Initial call to generate a title on load
        generateTitle();
    });
</script>

</body>
</html>

